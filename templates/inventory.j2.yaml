[all]
{% for role, nodes in servers.items() %}
{% for node in nodes %}
{% set cmd= "grep ctlplane_port_ip kolla-servers/" + node.keys()[0] + "-info.yaml" %}
{{ node.keys()[0] }} ansible_host={{ lookup('pipe', cmd).split()[1] }} ansible_ssh_user=centos
{% endfor %}
{% endfor %}


[controller]
{% for role, nodes in servers.items() %}
{% if role == 'controller' %}
{% for node in nodes %}
{% set cmd= "grep ctlplane_port_ip kolla-servers/" + node.keys()[0] + "-info.yaml" %}
{{ node.keys()[0] }} ansible_host={{ lookup('pipe', cmd).split()[1] }} ansible_ssh_user=centos
{% endfor %}
{% endif %}
{% endfor %}


[compute]
{% for role, nodes in servers.items() %}
{% if role == 'compute' %}
{% for node in nodes %}
{% set cmd= "grep ctlplane_port_ip kolla-servers/" + node.keys()[0] + "-info.yaml" %}
{{ node.keys()[0] }} ansible_host={{ lookup('pipe', cmd).split()[1] }} ansible_ssh_user=centos
{% endfor %}
{% endif %}
{% endfor %}


[network]
{% for role, nodes in servers.items() %}
{% if role == 'network' %}
{% for node in nodes %}
{% set cmd= "grep ctlplane_port_ip kolla-servers/" + node.keys()[0] + "-info.yaml" %}
{{ node.keys()[0] }} ansible_host={{ lookup('pipe', cmd).split()[1] }} ansible_ssh_user=centos
{% endfor %}
{% endif %}
{% endfor %}
